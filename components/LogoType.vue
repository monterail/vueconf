<template>
  <svg class="vueconf-logo" width="100%" height="100%" viewBox="0 0 331 259" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.5;">
      <g transform="matrix(1,0,0,1,-3163.82,-1347.75)">
          <g id="vue-conflogo" transform="matrix(0.258594,0,0,0.32375,3163.82,1347.75)">
              <rect x="0" y="0" width="1280" height="800" style="fill:white;"/>
              <g transform="matrix(5.59153,0,0,4.46621,-2926.01,-1446.34)">
                  <g transform="matrix(1,0,0,0.735586,-1366.36,111.03)">
                      <rect x="1946" :y="421 - treeBase_1" width="1.569" :height="treeBase_1" style="fill:rgb(52,73,95);"/>
                  </g>
                  <g transform="matrix(1,0,0,0.735586,-1340.66,111.03)">
                      <rect x="1946" :y="421 - treeBase_2" width="1.569" :height="treeBase_2" style="fill:rgb(52,73,95);"/>
                  </g>
                  <g :transform="logoTransformation" :opacity="logoOpacity">
                      <g transform="matrix(0.230171,0,0,0.230171,20.6509,11.8073)">
                          <path d="M100.5,187L0,14L201,14L100.5,187ZM100.5,118L161,14L40,14L100.5,118Z" style="fill:rgb(58,185,130);"/>
                      </g>
                      <path d="M49.154,15.03L57.708,15.03L43.783,38.967L29.858,15.03L38.412,15.03L43.783,24.236L49.154,15.03Z" style="fill:rgb(52,73,95);"/>
                  </g>
                  <g transform="matrix(0.25,0,0,0.25,577.25,193.34)">
                      <circle cx="363" cy="715" :r="sunRadius" style="fill:none;stroke:rgb(58,185,130);stroke-width:15.22px;"/>
                  </g>
                  <g transform="matrix(0.25,0,0,0.25,489.674,212.34)">
                      <circle cx="363" cy="715" :r="treeRadius_1_2" style="fill:rgb(58,185,130);"/>
                  </g>
                  <g transform="matrix(0.25,0,0,0.25,587.02,235.004)">
                      <circle cx="363" cy="715" :r="smallTreeRadius_1" style="fill:rgb(58,185,130);"/>
                  </g>
                  <g transform="matrix(0.125,0,0,0.125,638.395,327.379)">
                      <circle cx="363" cy="715" :r="smallTreeRadius_2" style="fill:rgb(58,185,130);"/>
                  </g>
                  <g transform="matrix(0.354167,0,0,0.354167,451.862,146.361)">
                      <circle cx="363" cy="715" :r="treeRadius_1" style="fill:rgb(58,185,130);"/>
                  </g>
                  <g transform="matrix(0.625,0,0,0.625,379.253,-53.7848)">
                      <circle cx="363" cy="715" :r="treeRadius_2" style="fill:rgb(58,185,130);"/>
                  </g>
              </g>
              <g transform="matrix(6.40824,0,0,5.11855,-485.016,-963.959)">
                  <path
                  :transform="`translate(0, ${typo.v})`" :fill-opacity="typo.vO" d="M115.088,290L113.036,290L109.82,281.504L112.124,281.504L114.092,287.528L114.14,287.528L116.096,281.504L118.364,281.504L115.088,290Z" style="fill:rgb(52,73,95);fill-rule:nonzero;"/>
                  <path :transform="`translate(0, ${typo.u})`" :fill-opacity="typo.uO" d="M138.26,286.796C138.26,287.308 138.174,287.774 138.002,288.194C137.83,288.614 137.584,288.974 137.264,289.274C136.944,289.574 136.558,289.808 136.106,289.976C135.654,290.144 135.152,290.228 134.6,290.228C134.04,290.228 133.536,290.144 133.088,289.976C132.64,289.808 132.26,289.574 131.948,289.274C131.636,288.974 131.396,288.614 131.228,288.194C131.06,287.774 130.976,287.308 130.976,286.796L130.976,281.504L133.016,281.504L133.016,286.628C133.016,286.86 133.046,287.08 133.106,287.288C133.166,287.496 133.258,287.682 133.382,287.846C133.506,288.01 133.67,288.14 133.874,288.236C134.078,288.332 134.324,288.38 134.612,288.38C134.9,288.38 135.146,288.332 135.35,288.236C135.554,288.14 135.72,288.01 135.848,287.846C135.976,287.682 136.068,287.496 136.124,287.288C136.18,287.08 136.208,286.86 136.208,286.628L136.208,281.504L138.26,281.504L138.26,286.796Z" style="fill:rgb(52,73,95);fill-rule:nonzero;"/>
                  <path
                  :transform="`translate(0, ${typo.e})`" :fill-opacity="typo.eO"
                   d="M151.916,290L151.916,281.504L157.628,281.504L157.628,283.244L153.896,283.244L153.896,284.84L157.424,284.84L157.424,286.484L153.896,286.484L153.896,288.248L157.844,288.248L157.844,290L151.916,290Z" style="fill:rgb(52,73,95);fill-rule:nonzero;"/>
                  <path :transform="`translate(0, ${typo.c})`" :fill-opacity="typo.cO" d="M178.676,288.824C178.3,289.256 177.836,289.598 177.284,289.85C176.732,290.102 176.096,290.228 175.376,290.228C174.72,290.228 174.114,290.12 173.558,289.904C173.002,289.688 172.52,289.382 172.112,288.986C171.704,288.59 171.384,288.116 171.152,287.564C170.92,287.012 170.804,286.404 170.804,285.74C170.804,285.06 170.922,284.444 171.158,283.892C171.394,283.34 171.72,282.87 172.136,282.482C172.552,282.094 173.04,281.796 173.6,281.588C174.16,281.38 174.764,281.276 175.412,281.276C176.012,281.276 176.602,281.382 177.182,281.594C177.762,281.806 178.232,282.116 178.592,282.524L177.2,283.916C177.008,283.652 176.756,283.456 176.444,283.328C176.132,283.2 175.812,283.136 175.484,283.136C175.124,283.136 174.794,283.202 174.494,283.334C174.194,283.466 173.936,283.648 173.72,283.88C173.504,284.112 173.336,284.386 173.216,284.702C173.096,285.018 173.036,285.364 173.036,285.74C173.036,286.124 173.096,286.476 173.216,286.796C173.336,287.116 173.502,287.39 173.714,287.618C173.926,287.846 174.18,288.024 174.476,288.152C174.772,288.28 175.096,288.344 175.448,288.344C175.856,288.344 176.212,288.264 176.516,288.104C176.82,287.944 177.064,287.736 177.248,287.48L178.676,288.824Z" style="fill:rgb(52,73,95);fill-rule:nonzero;"/>
                  <path :transform="`translate(0, ${typo.o})`" :fill-opacity="typo.oO" d="M200.264,285.716C200.264,286.388 200.148,287.002 199.916,287.558C199.684,288.114 199.362,288.59 198.95,288.986C198.538,289.382 198.048,289.688 197.48,289.904C196.912,290.12 196.296,290.228 195.632,290.228C194.968,290.228 194.354,290.12 193.79,289.904C193.226,289.688 192.738,289.382 192.326,288.986C191.914,288.59 191.592,288.114 191.36,287.558C191.128,287.002 191.012,286.388 191.012,285.716C191.012,285.036 191.128,284.422 191.36,283.874C191.592,283.326 191.914,282.86 192.326,282.476C192.738,282.092 193.226,281.796 193.79,281.588C194.354,281.38 194.968,281.276 195.632,281.276C196.296,281.276 196.912,281.38 197.48,281.588C198.048,281.796 198.538,282.092 198.95,282.476C199.362,282.86 199.684,283.326 199.916,283.874C200.148,284.422 200.264,285.036 200.264,285.716ZM198.068,285.716C198.068,285.348 198.008,285.004 197.888,284.684C197.768,284.364 197.602,284.09 197.39,283.862C197.178,283.634 196.922,283.454 196.622,283.322C196.322,283.19 195.992,283.124 195.632,283.124C195.272,283.124 194.944,283.19 194.648,283.322C194.352,283.454 194.096,283.634 193.88,283.862C193.664,284.09 193.498,284.364 193.382,284.684C193.266,285.004 193.208,285.348 193.208,285.716C193.208,286.1 193.268,286.454 193.388,286.778C193.508,287.102 193.674,287.38 193.886,287.612C194.098,287.844 194.352,288.026 194.648,288.158C194.944,288.29 195.272,288.356 195.632,288.356C195.992,288.356 196.32,288.29 196.616,288.158C196.912,288.026 197.168,287.844 197.384,287.612C197.6,287.38 197.768,287.102 197.888,286.778C198.008,286.454 198.068,286.1 198.068,285.716Z" style="fill:rgb(52,73,95);fill-rule:nonzero;"/>
                  <path :transform="`translate(0, ${typo.n})`" :fill-opacity="typo.nO" d="M219.02,290L215.6,284.444L215.564,284.444L215.612,290L213.62,290L213.62,281.504L215.96,281.504L219.368,287.048L219.404,287.048L219.356,281.504L221.348,281.504L221.348,290L219.02,290Z" style="fill:rgb(52,73,95);fill-rule:nonzero;"/>
                  <path :transform="`translate(0, ${typo.f})`" :fill-opacity="typo.fO" d="M237.128,283.256L237.128,285.008L240.416,285.008L240.416,286.7L237.128,286.7L237.128,290L235.1,290L235.1,281.504L240.692,281.504L240.692,283.256L237.128,283.256Z" style="fill:rgb(52,73,95);fill-rule:nonzero;"/>
              </g>
              <g transform="matrix(3.86707,0,0,3.0888,59.9241,-274.772)" :opacity="dateOpacity">
                  <text x="127.168px" y="290px" style="font-family:'AvenirNext-Bold', 'Avenir Next', sans-serif;font-weight:700;font-size:8px;fill:rgb(52,73,95);">2<tspan x="140.336px 153.504px 166.672px " y="290px 290px 290px ">017</tspan></text>
              </g>
              <g transform="matrix(9.22147,0,0,3.0888,-1118.62,-302.937)">
                  <path :d="separator" :stroke-opacity="separatorOpacity" style="fill:none;stroke:rgb(58,185,130);stroke-width:1.09px;stroke-linecap:round;"/>
              </g>
              <g transform="matrix(3.86707,0,0,3.0888,-7065.69,-3547.11)">
                  <circle cx="1974.5" cy="1310.5" :r="dotRadius" style="fill:rgb(58,185,130);"/>
              </g>
          </g>
      </g>
  </svg>
</template>

<script>
function bounce (progress) {
  for(var a = 0, b = 1, result; 1; a += b, b /= 2) {
    if (progress >= (7 - 4 * a) / 11) {
      return -Math.pow((11 - 6 * a - 11 * progress) / 4, 2) + Math.pow(b, 2);
    }
  }
}

function circ (progress) {
  return 1 - Math.sin(Math.acos(progress))
}

function linear (progress) {
  return progress
}

function back (x) {
  return progress => Math.pow(progress, 2) * ((x + 1) * progress - x)
}

function makeEaseInOut (delta) {
  return function (progress) {
    if (progress < .5) {
      return delta(2*progress) / 2
    }
    else {
      return (2 - delta(2*(1-progress))) / 2
    }
  }
}

function makeEaseOut (delta) {
  return function (progress) {
    return 1 - delta(1 - progress)
  }
}

const bounceEaseOut = makeEaseOut(bounce)
const backEaseOut = pushBack => makeEaseOut(back(pushBack))
const circEaseInOut = makeEaseInOut(circ)
const circEaseOut = makeEaseOut(circ)

function wait (duration) {
  return new Promise(resolve => setTimeout(() => resolve(), duration))
}

function animate (duration, delta, step) {
  return new Promise(
    function (resolve, reject) {
      const start = performance.now()

      const animation = function (t) {
        let progress = (t - start) / duration

        if (progress > 1) progress = 1

        step(delta(progress))

        if (progress !== 1) {
          window.requestAnimationFrame(animation)
        } else {
          resolve()
        }
      }
      window.requestAnimationFrame(animation)
    }
  )
}

function createStep (obj, property, from, to) {
  const absTo = Math.abs(to - from)
  return progress => {
    obj[property] = to > from
      ? from + (absTo * progress)
      : from - (absTo * progress)
  }
}

function combineSteps (...steps) {
  return function (progress) {
    steps.forEach(step => step(progress))
  }
}

function createAnimation (duration, delta, step) {
  return () => animate(duration, delta, step)
}

function* toGenerator (iterable) {
  yield* iterable
}

function stagger (animations, delay) {
  const animationsGenerator = toGenerator(animations)
  async function animateNext () {
    const { value: animation, done } = animationsGenerator.next()
    if (!done) {
      animation()
      await wait(delay)
      animateNext()
    }
  }
  animateNext()
}

export default {
  data () {
    return {
      logoDegrees: 180,
      logoY: -100,
      logoOpacity: 0,
      sunRadius: 0,
      treeBase_1: 0,
      treeRadius_1: 0,
      treeRadius_1_2: 0,
      treeBase_2: 0,
      treeRadius_2: 0,
      smallTreeRadius_1: 0,
      smallTreeRadius_2: 0,
      typo: {
        v: 25,
        u: 25,
        e: 25,
        c: 25,
        o: 25,
        n: 25,
        f: 25,
        vO: 0,
        uO: 0,
        eO: 0,
        cO: 0,
        oO: 0,
        nO: 0,
        fO: 0
      },
      separatorGrowth: 0,
      separatorOpacity: 0,
      dateOpacity: 0,
      dotRadius: 0
    }
  },
  computed: {
    logoTransformation () {
      return `matrix(-1,-1.22465e-16,1.22465e-16,-1,683.783,434.939) rotate(${this.logoDegrees}, 44, 34) translate(0, ${this.logoY})`
    },
    separator () {
      return `M${190 - this.separatorGrowth},280L${190 + this.separatorGrowth},280`
    }
  },
  methods: {
    async animateLogo () {
      await animate(
        1400,
        backEaseOut(2),
        combineSteps(
          createStep(this, 'logoY', -100, 0),
          createStep(this, 'logoOpacity', 0, 1)
        )
      )
      await wait(200)
      await animate(400, circEaseInOut, createStep(this, 'logoDegrees', 180, 360))
      return
    },
    async animateSun () {
      await animate(600, backEaseOut(10), createStep(this, 'sunRadius', 0, 27))
    },
    async animateTrees () {
      animate(300, circEaseInOut, createStep(this, 'treeBase_1', 0, 20))
      await wait(150)
      animate(300, circEaseInOut, createStep(this, 'treeBase_2', 0, 20))
      await wait(250)
      animate(300, backEaseOut(5), createStep(this, 'treeRadius_1', 0, 24))
      animate(250, backEaseOut(3), createStep(this, 'smallTreeRadius_1', 0, 24))
      await wait(150)
      animate(300, backEaseOut(5), createStep(this, 'treeRadius_2', 0, 24))
      animate(250, backEaseOut(3), createStep(this, 'smallTreeRadius_2', 0, 24))
      await wait(250)
      animate(300, backEaseOut(5), createStep(this, 'treeRadius_1_2', 0, 24))
      await wait(100)
    },
    async animateTypo () {
      const duration = 500
      stagger([
        createAnimation(duration, backEaseOut(1), combineSteps(
          createStep(this.typo, 'vO', 0, 1),
          createStep(this.typo, 'v', 25, 0)
        )),
        createAnimation(duration, backEaseOut(1), combineSteps(
          createStep(this.typo, 'uO', 0, 1),
          createStep(this.typo, 'u', 25, 0)
        )),
        createAnimation(duration, backEaseOut(1), combineSteps(
          createStep(this.typo, 'eO', 0, 1),
          createStep(this.typo, 'e', 25, 0)
        )),
        createAnimation(duration, backEaseOut(2), combineSteps(
          createStep(this.typo, 'cO', 0, 1),
          createStep(this.typo, 'c', 25, 0)
        )),
        createAnimation(duration, backEaseOut(2), combineSteps(
          createStep(this.typo, 'oO', 0, 1),
          createStep(this.typo, 'o', 25, 0)
        )),
        createAnimation(duration, backEaseOut(2), combineSteps(
          createStep(this.typo, 'nO', 0, 1),
          createStep(this.typo, 'n', 25, 0)
        )),
        createAnimation(duration, backEaseOut(2), combineSteps(
          createStep(this.typo, 'fO', 0, 1),
          createStep(this.typo, 'f', 25, 0
        )))
      ], 100)
      await wait(500)
      animate(duration, backEaseOut(3), createStep(this, 'dotRadius', 0, 1.5))
    },
    async animateDate () {
      animate(300, circEaseInOut, createStep(this, 'separatorOpacity', 0, 1))
      animate(700, circEaseInOut, createStep(this, 'separatorGrowth', 0, 20))
      await wait(400)
      animate(700, circEaseInOut, createStep(this, 'dateOpacity', 0, 1))
    }
  },
  async mounted () {
    if (process.BROWSER_BUILD) {
      await this.animateLogo()
      this.animateTrees()
      await wait(800)
      this.animateTypo()
      this.animateSun()
      await wait(400)
      this.animateDate()
    }
  }
}
</script>
